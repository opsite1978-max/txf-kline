<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°æŒ‡æ±ºç­–æ ¸å¿ƒ V17.1 (Breakout)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --input-bg: #334155; --text: #f1f5f9; --red: #ef4444; --green: #10b981; --gold: #f59e0b; --blue: #3b82f6; --purple: #a855f7; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 100px; -webkit-font-smoothing: antialiased; }
        .app-container { max-width: 600px; margin: 0 auto; background: var(--card); min-height: 100vh; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .header { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #334155; }
        h1 { margin: 0; font-size: 18px; font-weight: 800; letter-spacing: 0.5px; background: linear-gradient(90deg, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { font-size: 10px; color: #64748b; margin-top: 2px; }

        .portal-bar { display: flex; gap: 10px; padding: 12px 15px; background: #0b1120; overflow-x: auto; border-bottom: 1px solid #333; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .portal-bar::-webkit-scrollbar { display: none; }
        .portal-btn { flex: 0 0 auto; padding: 8px 14px; border-radius: 20px; font-size: 12px; text-decoration: none; color: #cbd5e1; border: 1px solid #475569; transition: 0.2s; display: flex; align-items: center; gap: 6px; background: #1e293b; font-weight: 500; }
        .portal-btn:active { transform: scale(0.95); background: #334155; border-color: var(--blue); color: #fff; }

        .chart-wrapper { padding: 15px; background: #0b1120; border-bottom: 1px solid #333; }
        .chart-container { position: relative; height: 200px; width: 100%; }

        .btn-group { padding: 15px; display: grid; grid-template-columns: 2fr 1fr 0.5fr; gap: 10px; }
        .btn { padding: 14px; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-auto { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .btn-record { background: linear-gradient(135deg, #10b981, #059669); }
        .btn-clear { background: #475569; }

        .section { padding: 0 20px 15px 20px; animation: fadeIn 0.5s ease; }
        .section-title { font-size: 13px; color: #94a3b8; font-weight: 700; margin-bottom: 10px; border-left: 4px solid var(--blue); padding-left: 8px; margin-top: 15px; display: flex; justify-content: space-between; align-items: center; }

        .row { display: flex; gap: 10px; margin-bottom: 12px; }
        .col { flex: 1; }
        label { display: block; font-size: 11px; color: #94a3b8; margin-bottom: 5px; font-weight: 500; }
        input { width: 100%; background: var(--input-bg); border: 1px solid #475569; color: white; padding: 12px; border-radius: 8px; font-size: 18px; font-weight: 700; text-align: center; outline: none; box-sizing: border-box; transition: 0.2s; }
        input:focus { border-color: var(--blue); background: #1e293b; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); }

        .hl-input input { border-color: var(--gold); background: #422006; color: #fbbf24; font-size: 22px; }
        .op-input input { border-color: #8b5cf6; background: #2e1065; color: #d8b4fe; }
        .total-input input { border-color: #ec4899; background: #500724; color: #fbcfe8; font-size: 20px; }

        .op-radar-box { margin: 10px 0; padding: 15px; background: #111827; border: 1px solid #374151; border-radius: 12px; position: relative; box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        .op-bar-container { height: 16px; background: #334155; border-radius: 8px; position: relative; margin: 25px 0; overflow: hidden; }
        .op-marker { position: absolute; top: -4px; bottom: -4px; width: 6px; background: #fff; border-radius: 3px; box-shadow: 0 0 10px #fff; z-index: 10; transition: left 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .zone-pressure { position: absolute; right: 0; top: 0; bottom: 0; width: 40%; background: linear-gradient(to left, rgba(239,68,68,0.6), transparent); }
        .zone-support { position: absolute; left: 0; top: 0; bottom: 0; width: 40%; background: linear-gradient(to right, rgba(16,185,129,0.6), transparent); }
        .op-space { display: flex; justify-content: space-between; font-size: 11px; font-family: monospace; }

        .key-levels-box { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; background: #0f172a; padding: 10px; border-radius: 10px; border: 1px solid #334155; }
        .level-item { text-align: center; padding: 8px 4px; background: #1e293b; border-radius: 6px; }
        .level-title { font-size: 10px; color: #64748b; margin-bottom: 2px; }
        .level-val { font-size: 14px; font-weight: 800; color: #fff; }
        .level-up { color: #ef4444; } .level-mid { color: #f59e0b; } .level-down { color: #10b981; }

        /* âœ… æ–°å¢ï¼šçªç ´åˆ†æé¢æ¿ */
        .breakout-box { background:#0b1120; border:1px solid #334155; border-radius:12px; padding:12px; }
        .breakout-grid { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px; }
        .bcard { background:#111827; border:1px solid #243041; border-radius:10px; padding:10px; }
        .btitle { font-size:11px; color:#94a3b8; margin-bottom:6px; }
        .bval { font-size:18px; font-weight:900; }
        .bsub { font-size:11px; color:#64748b; margin-top:6px; line-height:1.4; }
        .tag { display:inline-block; font-size:11px; padding:2px 8px; border-radius:999px; border:1px solid #334155; margin-left:6px; }
        .tag-up { background: rgba(239,68,68,0.15); color:#fca5a5; border-color: rgba(239,68,68,0.35); }
        .tag-dn { background: rgba(16,185,129,0.15); color:#86efac; border-color: rgba(16,185,129,0.35); }
        .tag-neu { background: rgba(148,163,184,0.12); color:#cbd5e1; border-color: rgba(148,163,184,0.25); }

        .verdict-box { background: rgba(15, 23, 42, 0.95); padding: 20px; text-align: center; border-top: 1px solid #333; position: sticky; bottom: 0; backdrop-filter: blur(10px); z-index: 90; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); border-radius: 20px 20px 0 0; }
        .verdict { font-size: 26px; font-weight: 900; margin-bottom: 5px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .desc { font-size: 13px; color: #94a3b8; margin-bottom: 10px; }
        .target-box { display: flex; justify-content: space-between; background: #1e293b; padding: 10px 20px; border-radius: 10px; margin-top: 10px; }

        #loading { display: none; animation: spin 1s infinite linear; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>å°æŒ‡æ±ºç­–æ ¸å¿ƒ V17.1</h1>
        <div class="subtitle">æˆ°å ´åœ°åœ– â€¢ åƒ¹å·®ç›£æ§ â€¢ çªç ´åˆ†æ</div>
    </div>

    <div class="portal-bar">
        <a href="https://www.wantgoo.com/option/support-resistance" target="_blank" class="portal-btn">ğŸ›¡ï¸ ç©è‚¡OPå¤§é‡å€</a>
        <a href="https://www.wantgoo.com/futures/institutional-investors/net-open-interest" target="_blank" class="portal-btn">ğŸ¦ ç©è‚¡ä¸»åŠ›</a>
        <a href="https://www.wantgoo.com/option/put-call-ratio" target="_blank" class="portal-btn">ğŸ“Š P/C Ratio</a>
        <a href="https://www.wantgoo.com/futures/retail-indicator/wmt&" target="_blank" class="portal-btn">ğŸœ æ•£æˆ¶æŒ‡æ¨™</a>
    </div>

    <div class="chart-wrapper">
        <div class="chart-container">
            <canvas id="trendChart"></canvas>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn btn-auto" onclick="autoFetch()">
            âš¡ æŠ“å–æ˜¨æ”¶/æ³¢å‹• <span id="loading">â†»</span>
        </button>
        <button class="btn btn-record" onclick="recordData()">ğŸ’¾ è¨˜éŒ„</button>
        <button class="btn btn-clear" onclick="clearHistory()">ğŸ—‘ï¸</button>
    </div>

    <div class="section">
        <div class="section-title">ğŸ›¡ï¸ é¸æ“‡æ¬Šæˆ°å ´ (è¼¸å…¥æœ€å¤§é‡å€)</div>
        <div class="row">
            <div class="col op-input">
                <label>åœ°æ¿ (æœ€å¤§ Put)</label>
                <input type="number" id="op_support" placeholder="ä¾‹å¦‚ 28200" oninput="calc()">
            </div>
            <div class="col op-input">
                <label>å¤©èŠ±æ¿ (æœ€å¤§ Call)</label>
                <input type="number" id="op_pressure" placeholder="ä¾‹å¦‚ 29000" oninput="calc()">
            </div>
        </div>

        <div class="op-radar-box">
            <div class="op-space">
                <span id="space-down" style="color:#10b981;">ç­‰å¾…æ•¸æ“š</span>
                <span id="space-up" style="color:#ef4444;">ç­‰å¾…æ•¸æ“š</span>
            </div>
            <div class="op-bar-container">
                <div class="zone-support"></div>
                <div class="zone-pressure"></div>
                <div id="price-marker" class="op-marker" style="left: 50%;"></div>
            </div>
            <div style="display:flex; justify-content:space-between; color:#666; font-size:10px;">
                <span>æ”¯æ’å€</span>
                <span id="radar-tx" style="color:#fff; font-weight:bold;">--</span>
                <span>å£“åŠ›å€</span>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">
            <span>1. åƒ¹æ ¼ç›£æ§</span>
            <span id="spread-tag" style="font-size:11px; padding:2px 6px; border-radius:4px; background:#333;">--</span>
        </div>
        <div class="row">
            <div class="col hl-input">
                <label>ğŸ“ å°æŒ‡æœŸ (å¿…å¡«)</label>
                <input type="number" id="tx" placeholder="è¼¸å…¥ç›®å‰é»æ•¸" oninput="calc()">
            </div>
            <div class="col">
                <label>âš–ï¸ åŠ æ¬ŠæŒ‡æ•¸ (è‡ªå‹•)</label>
                <input type="number" id="spot" disabled placeholder="è‡ªå‹•æŠ“å–" oninput="calc()">
            </div>
        </div>
        <div class="row">
            <div class="col">
                <label>ğŸ›¡ï¸ P/C Ratio (%)</label>
                <input type="number" id="pc" placeholder="æ‰‹å‹•è¼¸å…¥" oninput="calc()">
            </div>
            <div class="col">
                <label>ATR æ³¢å‹•</label>
                <input type="number" id="atr" oninput="calc()">
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">2. ä¸»åŠ›ç±Œç¢¼</div>
        <div class="row">
            <div class="col total-input">
                <label>ğŸ¦ æ³•äººç¸½å’Œ (è‡ª+æŠ•+å¤–)</label>
                <input type="number" id="total_sum" placeholder="çœ‹ç©è‚¡ç¶²å¡«å…¥" oninput="calc()">
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">3. æ•£æˆ¶ (è¼¸å…¥å£æ•¸)</div>
        <div style="background:#1e293b; padding:10px; border-radius:8px; border:1px solid #334155;">
            <div style="font-size:11px; color:#aaa; margin-bottom:5px; text-align:center;">å°å° MTX</div>
            <div class="row" style="margin-bottom:0;">
                <div class="col">
                    <input type="number" id="mtx_long" placeholder="å¤šå–®" style="color:#fca5a5; border-color:#7f1d1d;" oninput="calc()">
                </div>
                <div class="col">
                    <input type="number" id="mtx_short" placeholder="ç©ºå–®" style="color:#86efac; border-color:#064e3b;" oninput="calc()">
                </div>
            </div>
        </div>
        <div style="height:8px;"></div>
        <div style="background:#1e293b; padding:10px; border-radius:8px; border:1px solid #334155;">
            <div style="font-size:11px; color:#aaa; margin-bottom:5px; text-align:center;">å¾®å° TMF</div>
            <div class="row" style="margin-bottom:0;">
                <div class="col">
                    <input type="number" id="tmf_long" placeholder="å¤šå–®" style="color:#fca5a5; border-color:#7f1d1d;" oninput="calc()">
                </div>
                <div class="col">
                    <input type="number" id="tmf_short" placeholder="ç©ºå–®" style="color:#86efac; border-color:#064e3b;" oninput="calc()">
                </div>
            </div>
        </div>
    </div>

    <div class="section" style="margin-bottom:10px;">
        <div class="section-title">ğŸ”‘ åƒè€ƒé»ä½ (æ˜¨æ”¶è¨ˆç®—)</div>
        <div class="key-levels-box">
            <div class="level-item"><div class="level-title">ä¸Šé—œ</div><div id="kp_high" class="level-val level-up">--</div></div>
            <div class="level-item"><div class="level-title">ä¸­é—œ</div><div id="kp_mid" class="level-val level-mid">--</div></div>
            <div class="level-item"><div class="level-title">ä¸‹é—œ</div><div id="kp_low" class="level-val level-down">--</div></div>
            <div class="level-item"><div class="level-title">è½‰æŠ˜å£“</div><div id="pivot_res" class="level-val level-up">--</div></div>
            <div class="level-item"><div class="level-title">è½‰æŠ˜åƒ¹</div><div id="pivot_p" class="level-val level-mid">--</div></div>
            <div class="level-item"><div class="level-title">è½‰æŠ˜æ’</div><div id="pivot_sup" class="level-val level-down">--</div></div>
        </

